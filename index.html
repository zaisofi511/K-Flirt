<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>K-Flirt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- icon -->
  <link rel="icon" type="image/png" href="search.png" />
  <link rel="apple-touch-icon" href="search.png" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: dark;
      font-size: 17px;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: #05060a;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 480px; /* portrait feel for phone */
      padding: 18px 12px 32px;
    }

    .card {
      width: 100%;
      background: radial-gradient(circle at top left, #1d2233 0, #0b0c12 55%, #05060a 100%);
      border-radius: 20px;
      padding: 18px 16px 20px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    h1 {
      font-size: 1.45rem;
      margin: 0 0 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    h1 .emoji { font-size: 1.7rem; }

    .subtitle {
      font-size: 0.9rem;
      color: #a0a4b8;
      margin-bottom: 10px;
    }

    .header-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 5px;
      color: #c8cbe0;
    }

    textarea {
      width: 100%;
      min-height: 110px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(9, 11, 20, 0.96);
      color: #f5f5f5;
      padding: 10px 12px;
      font-size: 0.98rem;
      resize: vertical;
      outline: none;
    }
    textarea:focus {
      border-color: #4f8cff;
      box-shadow: 0 0 0 1px rgba(79, 140, 255, 0.5);
    }

    .hint {
      font-size: 0.8rem;
      color: #7f83a4;
      margin-top: 4px;
      margin-bottom: 10px;
    }

    /* API / model settings */
    #toggleApiPanelBtn {
      align-self: flex-start;
      background: transparent;
      color: #d3dcff;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      font-size: 0.85rem;
      padding: 7px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    #toggleApiPanelBtn.saved {
      border-color: #4f8cff;
      color: #bcd2ff;
    }

    .api-panel {
      display: none;
      background: rgba(10, 12, 20, 0.97);
      border-radius: 14px;
      padding: 12px 12px 10px;
      margin-bottom: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .api-input {
      width: 100%;
      padding: 9px 12px;
      border-radius: 9px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(5, 7, 14, 0.97);
      color: #fff;
      font-size: 0.9rem;
      outline: none;
      margin-bottom: 10px;
    }
    .api-input:focus { border-color: #4f8cff; }

    .api-panel-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 2px;
      margin-bottom: 4px;
    }
    .api-panel-row button {
      font-size: 0.85rem;
      border-radius: 999px;
      padding: 7px 14px;
      border: none;
      cursor: pointer;
    }
    .api-panel-save {
      background: linear-gradient(135deg, #4f8cff, #9b6bff);
      color: #fff;
    }
    .api-panel-close {
      background: transparent;
      color: #bbb;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    #apiPanelStatus {
      font-size: 0.8rem;
      min-height: 1.2em;
    }

    /* tone selector */
    .tone-section { margin: 8px 0 10px; }
    .tone-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .tone-row label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      padding: 5px 10px;
      background: rgba(9, 11, 20, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      cursor: pointer;
    }
    .tone-row input { cursor: pointer; }

    /* buttons */
    .button-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 4px;
    }
    button {
      font-size: 0.95rem;
      border-radius: 999px;
      border: none;
      padding: 9px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-weight: 500;
    }
    #generateBtn {
      background: linear-gradient(135deg, #4f8cff, #9b6bff);
      color: #fff;
    }
    #generateBtn:disabled {
      opacity: 0.55;
      cursor: default;
    }
    #clearBtn {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: #ddd;
    }

    #status {
      font-size: 0.82rem;
      min-height: 1.2em;
      color: #a0a4b8;
    }
    #status.error { color: #ff8080; }

    .output-section {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.12);
    }
    .output-block {
      margin-bottom: 14px;
    }
    .output-label {
      font-size: 0.87rem;
      color: #c8cbe0;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: space-between;
    }
    .label-left {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .badge {
      font-size: 0.78rem;
      padding: 2px 9px;
      border-radius: 999px;
      background: rgba(79, 140, 255, 0.22);
      color: #d3dcff;
    }

    .output-text {
      background: rgba(5, 7, 14, 0.98);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 0.98rem;
      border: 1px solid rgba(255, 255, 255, 0.07);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .copy-btn {
      font-size: 0.8rem;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(10, 12, 20, 0.95);
      color: #dce2ff;
      cursor: pointer;
    }

    @media (min-width: 600px) {
      .container {
        padding-top: 26px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">

      <div class="header-row">
        <div>
          <h1><span class="emoji">üíå</span>K-Flirt</h1>
          <div class="subtitle">See their message in English and get your KR + EN reply.</div>
        </div>
        <button id="toggleApiPanelBtn">‚öôÔ∏è API</button>
      </div>

      <!-- API / model panel -->
      <div id="apiPanel" class="api-panel">
        <label for="apiKeyInput">API key</label>
        <input id="apiKeyInput" type="password" class="api-input" placeholder="sk_..." />

        <label for="modelInput">Model</label>
        <input id="modelInput" type="text" class="api-input" />

        <div class="api-panel-row">
          <button id="saveApiBtn" class="api-panel-save">üíæ Save</button>
          <button id="closeApiBtn" class="api-panel-close" type="button">‚úñ Close</button>
        </div>
        <div id="apiPanelStatus"></div>
      </div>

      <!-- tone -->
      <div class="tone-section">
        <label>Reply tone (pick one)</label>
        <div class="tone-row">
          <label><input type="checkbox" class="tone" id="toneSexual"> Sexual</label>
          <label><input type="checkbox" class="tone" id="toneWitty"> Witty</label>
          <label><input type="checkbox" class="tone" id="toneMature"> Mature</label>
        </div>
      </div>

      <!-- input -->
      <label for="koreanInput">Korean message</label>
      <textarea id="koreanInput" placeholder="Ïòà: Ïò§Îäò Î≠ê Ìï¥? Ïö∞Î¶¨ Ïù¥Î≤à Ï£ºÎßêÏóê ÎßåÎÇ†Íπå?"></textarea>
      <div class="hint">
        It will translate their message to English and generate your reply in Korean + English.
      </div>

      <!-- buttons -->
      <div class="button-row">
        <button id="generateBtn">Generate</button>
        <button id="clearBtn" type="button">Clear</button>
      </div>

      <div id="status"></div>

      <!-- output -->
      <div id="outputSection" class="output-section" style="display:none;">

        <!-- Their message in English -->
        <div class="output-block">
          <div class="output-label">
            <div class="label-left">
              <span>Their message (English)</span>
              <span class="badge">KR ‚Üí EN</span>
            </div>
          </div>
          <div id="outputInputEnglish" class="output-text"></div>
        </div>

        <!-- Korean reply -->
        <div class="output-block">
          <div class="output-label">
            <div class="label-left">
              <span>Your reply (Korean)</span>
              <span class="badge">KR</span>
            </div>
            <button id="copyKoreanBtn" class="copy-btn" type="button">üìã Copy</button>
          </div>
          <div id="outputKorean" class="output-text"></div>
        </div>

        <!-- English reply -->
        <div class="output-block">
          <div class="output-label">
            <div class="label-left">
              <span>Your reply (English)</span>
              <span class="badge">EN</span>
            </div>
          </div>
          <div id="outputEnglish" class="output-text"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  const API_KEY_STORAGE = "groq_api_key";
  const MODEL_STORAGE   = "groq_model";

  const toggleBtn     = document.getElementById("toggleApiPanelBtn");
  const apiPanel      = document.getElementById("apiPanel");
  const apiInput      = document.getElementById("apiKeyInput");
  const modelInput    = document.getElementById("modelInput");
  const saveApiBtn    = document.getElementById("saveApiBtn");
  const closeApiBtn   = document.getElementById("closeApiBtn");
  const apiStatus     = document.getElementById("apiPanelStatus");

  const tones         = document.querySelectorAll(".tone");
  const inputKR       = document.getElementById("koreanInput");
  const statusEl      = document.getElementById("status");
  const generateBtn   = document.getElementById("generateBtn");
  const clearBtn      = document.getElementById("clearBtn");

  const outSec        = document.getElementById("outputSection");
  const outInputEN    = document.getElementById("outputInputEnglish");
  const outKR         = document.getElementById("outputKorean");
  const outEN         = document.getElementById("outputEnglish");
  const copyKoreanBtn = document.getElementById("copyKoreanBtn");

  // init API + model
  (function init() {
    const savedKey   = localStorage.getItem(API_KEY_STORAGE);
    const savedModel = localStorage.getItem(MODEL_STORAGE) || "llama-3.3-70b-versatile";

    if (savedKey) {
      apiInput.value = savedKey;
      toggleBtn.classList.add("saved");
      toggleBtn.textContent = "‚öôÔ∏è API (saved)";
    }
    modelInput.value = savedModel;
  })();

  toggleBtn.onclick = () => {
    apiPanel.style.display = apiPanel.style.display === "block" ? "none" : "block";
    apiStatus.textContent = "";
    apiStatus.style.color = "#a0a4b8";
  };

  closeApiBtn.onclick = () => {
    apiPanel.style.display = "none";
  };

  saveApiBtn.onclick = () => {
    const key   = apiInput.value.trim();
    const model = modelInput.value.trim();

    if (!key) {
      apiStatus.textContent = "API key cannot be empty.";
      apiStatus.style.color = "#ff8080";
      return;
    }
    if (!model) {
      apiStatus.textContent = "Model cannot be empty.";
      apiStatus.style.color = "#ff8080";
      return;
    }

    localStorage.setItem(API_KEY_STORAGE, key);
    localStorage.setItem(MODEL_STORAGE, model);

    apiStatus.textContent = "Saved.";
    apiStatus.style.color = "#96e6a1";
    toggleBtn.classList.add("saved");
    toggleBtn.textContent = "‚öôÔ∏è API (saved)";
  };

  // tone: behave like radio
  tones.forEach(t => {
    t.addEventListener("change", () => {
      if (t.checked) tones.forEach(o => { if (o !== t) o.checked = false; });
    });
  });

  function getTone() {
    if (document.getElementById("toneSexual").checked) return "sexual and bold";
    if (document.getElementById("toneWitty").checked)  return "witty and playful";
    if (document.getElementById("toneMature").checked) return "mature and confident";
    return "neutral flirty";
  }

  async function groqReply(apiKey, modelName, message, tone) {
    const body = {
      model: modelName,
      messages: [
        {
          role: "system",
          content: `
You are a dating assistant.

Given a Korean message from someone, you must:
1) Translate THEIR Korean message to natural English.
2) Generate ONE natural dating reply in Korean (informal, Î∞òÎßê) with tone: ${tone}.
3) Translate YOUR reply to English.

Return ONLY valid JSON with this exact structure:

{
  "input_english": "...",      // English translation of their Korean message
  "reply_korean": "...",       // Your Korean reply (informal, Î∞òÎßê)
  "reply_english": "..."       // English meaning of your reply
}
          `.trim()
        },
        { role: "user", content: message }
      ],
      temperature: 0.7,
      max_tokens: 400
    };

    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer " + apiKey
      },
      body: JSON.stringify(body)
    });

    if (!res.ok) {
      const raw = await res.text();
      throw new Error("Groq error: " + res.status + " " + raw);
    }

    const data = await res.json();
    let txt = (data.choices?.[0]?.message?.content || "").trim();

    if (txt.startsWith("```")) {
      txt = txt.replace(/```json/i, "").replace(/```/g, "").trim();
    }

    return JSON.parse(txt);
  }

  generateBtn.onclick = async () => {
    const apiKey    = localStorage.getItem(API_KEY_STORAGE);
    const modelName = localStorage.getItem(MODEL_STORAGE) || "llama-3.3-70b-versatile";
    const msg       = inputKR.value.trim();
    const tone      = getTone();

    statusEl.classList.remove("error");
    statusEl.textContent = "";

    if (!apiKey) {
      statusEl.textContent = "Save your API first.";
      statusEl.classList.add("error");
      apiPanel.style.display = "block";
      return;
    }
    if (!msg) {
      statusEl.textContent = "Enter a Korean message.";
      statusEl.classList.add("error");
      return;
    }

    generateBtn.disabled = true;
    generateBtn.textContent = "Generating...";
    statusEl.textContent = "Contacting Groq...";
    outSec.style.display = "none";

    try {
      const r = await groqReply(apiKey, modelName, msg, tone);

      outInputEN.textContent = (r.input_english || "").trim();
      outKR.textContent      = (r.reply_korean || "").trim();
      outEN.textContent      = (r.reply_english || "").trim();

      outSec.style.display = "block";
      statusEl.textContent = "Done.";
    } catch (e) {
      statusEl.classList.add("error");
      statusEl.textContent = e.message || "Unknown error";
    } finally {
      generateBtn.disabled = false;
      generateBtn.textContent = "üîÆ Generate";
    }
  };

  clearBtn.onclick = () => {
    inputKR.value      = "";
    outInputEN.textContent = "";
    outKR.textContent  = "";
    outEN.textContent  = "";
    outSec.style.display = "none";
    statusEl.textContent  = "";
    statusEl.classList.remove("error");
  };

  copyKoreanBtn.onclick = async () => {
    const text = outKR.textContent.trim();
    if (!text) {
      statusEl.classList.add("error");
      statusEl.textContent = "No Korean reply to copy.";
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      statusEl.classList.remove("error");
      statusEl.textContent = "Korean reply copied.";
    } catch (e) {
      statusEl.classList.add("error");
      statusEl.textContent = "Clipboard blocked by browser.";
    }
  };
</script>
</body>
</html>
